input {

    udp {
        port => <%= @collectd_port %>
        buffer_size => 1452
        codec => collectd{}
        type => "collectd"
    }

    file {
        path => "/etc/demo/logging.log"
        type => "log4j"
    }

    file {
        path => "/etc/demo/logs/access_log-20141019"
        type => "access"
        start_position => "beginning"
    }
}

filter {
    if [type] == "collectd" {

    } else if [type] == "log4j" {
        grok {
          match => [ "message", "%{TIMESTAMP_ISO8601} %{LOGLEVEL} %{GREEDYDATA}" ]
        }
    } else if [type] == "access" {
        grok {
          match => [ "message", "%{COMBINEDAPACHELOG}" ]
        }
    }
}


output {

    elasticsearch {
        <% @mastnodes = scope.function_hiera(['elastic_cluster::clientnodes']) -%>
        hosts => [<%= @mastnodes.map{ |node| "\"#{node}\"" }.join(',') %>]
        index => "%{type}-%{+YYYY.MM.dd}"
    }
}

